From e26ce8dc1433f3d4dd9a4554985ee04d6ef5ec14 Mon Sep 17 00:00:00 2001
From: Michael Allwright <allsey87@gmail.com>
Date: Wed, 28 Apr 2021 14:29:16 +0200
Subject: [PATCH 2/2] usb3503: Improve debugging messages and disable
 HUB_CONNECT logic

---
 drivers/usb/misc/usb3503.c | 16 ++++++++--------
 1 file changed, 8 insertions(+), 8 deletions(-)

diff --git a/drivers/usb/misc/usb3503.c b/drivers/usb/misc/usb3503.c
index 37c5af569fe8..64ff395b87ea 100644
--- a/drivers/usb/misc/usb3503.c
+++ b/drivers/usb/misc/usb3503.c
@@ -54,8 +54,8 @@ struct usb3503 {
 
 static int usb3503_reset(struct usb3503 *hub, int state)
 {
-	if (!state && hub->connect)
-		gpiod_set_value_cansleep(hub->connect, 0);
+	//if (!state && hub->connect)
+	//	gpiod_set_value_cansleep(hub->connect, 0);
 
 	if (hub->reset)
 		gpiod_set_value_cansleep(hub->reset, !state);
@@ -80,7 +80,7 @@ static int usb3503_connect(struct usb3503 *hub)
 			   (USB3503_SPILOCK_CONNECT
 				 | USB3503_SPILOCK_CONFIG));
 		if (err < 0) {
-			dev_err(dev, "SP_ILOCK failed (%d)\n", err);
+			dev_err(dev, "1. SP_ILOCK failed (%d)\n", err);
 			return err;
 		}
 
@@ -90,7 +90,7 @@ static int usb3503_connect(struct usb3503 *hub)
 					hub->port_off_mask,
 					hub->port_off_mask);
 			if (err < 0) {
-				dev_err(dev, "PDS failed (%d)\n", err);
+				dev_err(dev, "2. PDS failed (%d)\n", err);
 				return err;
 			}
 		}
@@ -100,7 +100,7 @@ static int usb3503_connect(struct usb3503 *hub)
 					 USB3503_SELF_BUS_PWR,
 					 USB3503_SELF_BUS_PWR);
 		if (err < 0) {
-			dev_err(dev, "CFG1 failed (%d)\n", err);
+			dev_err(dev, "3. CFG1 failed (%d)\n", err);
 			return err;
 		}
 
@@ -109,13 +109,13 @@ static int usb3503_connect(struct usb3503 *hub)
 					 (USB3503_SPILOCK_CONNECT
 					  | USB3503_SPILOCK_CONFIG), 0);
 		if (err < 0) {
-			dev_err(dev, "SP_ILOCK failed (%d)\n", err);
+			dev_err(dev, "4. SP_ILOCK failed (%d)\n", err);
 			return err;
 		}
 	}
 
-	if (hub->connect)
-		gpiod_set_value_cansleep(hub->connect, 1);
+	//if (hub->connect)
+	//	gpiod_set_value_cansleep(hub->connect, 1);
 
 	hub->mode = USB3503_MODE_HUB;
 	dev_info(dev, "switched to HUB mode\n");
-- 
2.17.1

